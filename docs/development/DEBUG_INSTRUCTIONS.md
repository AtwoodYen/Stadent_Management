# 課表週視圖調試指引

## 🎯 問題現象
週視圖沒有顯示任何排課資料，即使後端 API 有回傳資料。

## 🔍 調試步驟

### 1. 確認前端和後端服務運行狀態
```bash
# 檢查後端
curl http://localhost:3000/api/schedules

# 檢查前端
curl http://localhost:5177
```

### 2. 訪問課表頁面並查看調試輸出
1. 打開瀏覽器訪問：`http://localhost:5177/schedule`
2. 打開瀏覽器開發者工具 (F12)
3. 查看 Console 標籤頁

### 3. 預期的調試輸出順序
應該會看到以下調試訊息：

```
🎯 SchedulePage 組件已載入！當前時間: [時間]
🔄 SchedulePage 組件已載入，開始執行 fetchData
🔄 開始載入資料...
📞 呼叫學生 API: /api/students
📞 學生 API 回應狀態: 200
👥 學生資料載入成功: 8 筆
📞 呼叫課表 API: /api/schedules
📞 課表 API 回應狀態: 200
📅 課表資料載入成功: 8 筆
📅 課表原始資料: [陣列資料]
📅 當前週開始日期: 2025-06-23 Monday
📅 處理第 1 週: 2025-06-23 Monday
  📝 課程 1: 星期三 -> 數字: 3
    📅 計算日期: 2025-06-25 Wednesday
    ⏰ 時間: 15:15 - 16:45
    ✅ 課程已添加: [課程物件]
...
📊 最終結果:
👥 學生數量: 8
📅 課程數量: [應該 > 0]
📅 本週課程: [應該 > 0]
✅ 渲染主要內容，學生數: 8, 課程數: [數量], 本週課程: [數量]
```

### 4. 檢查週視圖渲染
當切換到週視圖時，應該看到：

```
=== 週視圖渲染調試 ===
週視圖 - 當前週開始日期: 2025-06-23 Monday
當前選擇日期: [當前日期]
所有課程資料: [課程陣列]
所有學生資料: [學生陣列]
時間槽: ["08:00", "08:30", ...]
時間槽數量: 28
📅 渲染第 1 天: 2025-06-23 Monday
  當天課程數量: [數量]
🔍 getLessonsForDate - 查詢日期: 2025-06-23 Monday
  總課程數: [數量]
  符合日期的課程數: [數量]
```

### 5. 檢查關鍵問題點

#### A. 如果看不到 SchedulePage 載入訊息
- 問題：路由可能沒有正確指向 SchedulePage
- 檢查：確認 App.tsx 中的路由設定

#### B. 如果 API 呼叫失敗
- 檢查網路標籤頁是否有 API 請求
- 檢查是否有 CORS 或代理問題

#### C. 如果資料載入成功但課程數量為 0
- 檢查資料轉換邏輯
- 檢查星期映射是否正確
- 檢查日期計算是否正確

#### D. 如果課程數量 > 0 但週視圖沒有顯示
- 檢查 `getLessonsForDate` 和 `getLessonsForTimeSlot` 函數
- 檢查日期和時間匹配邏輯
- 檢查 CSS 樣式是否隱藏了內容

### 6. 使用調試頁面
訪問 `http://localhost:5177/debug.html` 進行獨立的 API 和邏輯測試。

### 7. 強制測試模式
如果資料轉換失敗，程式會自動添加測試課程：
```
⚠️ 沒有課程資料，添加測試課程進行調試
✅ 已添加測試課程: [測試課程物件]
```

## 🔧 可能的問題和解決方案

### 問題 1：路由錯誤
**症狀**：看不到 SchedulePage 載入訊息
**解決**：確認 `/schedule` 路由指向 `SchedulePage`

### 問題 2：API 代理失敗
**症狀**：API 呼叫失敗
**解決**：檢查 Vite 代理配置，確認後端運行在 port 3000

### 問題 3：資料格式不匹配
**症狀**：API 成功但資料轉換失敗
**解決**：檢查欄位映射（chinese_name vs name）

### 問題 4：日期計算錯誤
**症狀**：課程數量 > 0 但找不到匹配的課程
**解決**：檢查週開始日設定和日期計算邏輯

### 問題 5：時間格式不匹配
**症狀**：日期匹配但時間槽沒有課程
**解決**：檢查時間格式轉換（ISO -> HH:mm）

## 📝 回報問題時請提供
1. 瀏覽器控制台的完整調試輸出
2. 網路標籤頁中的 API 請求狀態
3. 當前使用的瀏覽器和版本
4. 前端和後端的運行狀態

---
更新日期：2025-06-29 